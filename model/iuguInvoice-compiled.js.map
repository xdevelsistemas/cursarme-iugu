{"version":3,"sources":["iuguInvoice.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;AACb,MAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC7B,MAAM,eAAe,GAAG,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAC,AAyC1B,IAAI,aAAa,GAAG,CAAC,OAAO,EAAC,MAAM,KAAK;AACpC,QAAI,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAC,IAAI,CAAC,CAAC;;AAEzC,QAAI,UAAU,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;;AAEjD,QAAI,KAAK,GAAG,AAAC,MAAM,CAAC,UAAU,GAAG,eAAe,GAAG,GAAG,GAAI,GAAG,CAAC;;AAG9D,QAAI,MAAM,GAAG,AAAC,UAAU,IAAK;AACzB,YAAI,KAAK,GAAG,IAAI,IAAI,EAAE,CAAC;;AAEvB,YAAI,QAAQ,GAAG,UAAU,GAAG,KAAK,CAAC;AAClC,YAAI,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,IAAI,GAAG,IAAI,GAAG,EAAE,CAAA,AAAC,CAAC,CAAC;;AAExD,eAAO,QAAQ,GAAG,CAAC,CAAA;KACtB,CAAC;;AAGF,QAAI,QAAQ,GAAG,CAAC,gBAAgB,EAAE,KAAK,EAAE,UAAU,KAAK;AACpD,YAAI,KAAK,GAAG,CAAC,CAAC;;AAGd,YAAI,KAAK,EAAE;AACP,iBAAK,IAAI,KAAK,CAAC;SAClB;;AAED,YAAI,gBAAgB,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,EAAE;AACzC,iBAAK,IAAI,gBAAgB,CAAC;SAC7B;;AAGD,eAAO,KAAK,GAAG,GAAG;AAAC,KACtB,CAAC;;AAEF,QAAI,WAAW,GAAG,CAAC,UAAU,EAAE,cAAc,EAAE,UAAU,KAAK;;AAE1D,YAAI,UAAU,GAAG,CAAC,CAAC;;AAEnB,YAAI,MAAM,CAAC,UAAU,CAAC,EAAE;AACpB,sBAAU,IAAI,cAAc,CAAC;SAChC,MAAM;AACH,sBAAU,IAAI,UAAU,CAAC;SAC5B;;;AAAA,AAID,eAAO,UAAU,GAAG,GAAG,CAAC;KAE3B,CAAC;;AAEF,QAAI,aAAa,GAAG;AAChB,aAAK,EAAE,uBAAuB;AAC9B,gBAAQ,EAAE,YAAY;AACtB,aAAK,EAAE,CAAC;AACJ,uBAAW,EAAE,2BAA2B,CAAC,MAAM,CAAC,MAAM,CAAC,YAAY,EAAE,MAAM,CAAC,SAAS,EAAE,MAAM,CAAC,MAAM,EAAE,MAAM,CAAC,KAAK,CAAC;AACnH,oBAAQ,EAAE,GAAG;AACb,uBAAW,EAAE,WAAW,CAAC,MAAM,CAAC,cAAc,EAAE,MAAM,CAAC,cAAc,EAAG,UAAU,CAAC,CAAC,QAAQ,EAAE;SACjG,CAAC;AACF,wBAAgB,EAAE,kBAAkB;AACpC,aAAK,EAAE,MAAM;AACb,yBAAiB,EAAE,KAAK,CAAC,QAAQ,EAAE;AACnC,sBAAc,EAAE,GAAG;AACnB,wBAAgB,EAAE,MAAM;AACxB,wBAAgB,EAAE,MAAM;AACxB,oBAAY,EAAE,WAAW;KAC5B,CAAC;;AAGF,QAAI,IAAI,GAAG;AACP,aAAK,EAAE,iBAAiB;AACxB,gBAAQ,EAAE,YAAY;AACtB,aAAK,EAAE,CAAC;AACJ,uBAAW,EAAE,SAAS;AACtB,oBAAQ,EAAE,GAAG;AACb,uBAAW,EAAE,MAAM;SACtB,CAAC;KACL,CAAC;;AAEF,eAAW,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,EAAE,UAAU,GAAG,EAAE,QAAQ,EAAE;;;AAGnD,YAAI,GAAG,EAAC;AACJ,mBAAO,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;AACzB,mBAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;SACpB,MAAI;AACD,mBAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;SACzB;KAEJ,CACJ,CAAC;CAGL,CAAC;;AAGF,MAAM,CAAC,OAAO,GAAG;AACb,iBAAa,EAAG,aAAa;CAChC,CAAC","file":"iuguInvoice-compiled.js","sourcesContent":["'use strict';\nconst iugu = require('iugu');\nconst multaPercentual = 2;\n// exemplo de boleto\n//{\n//    \"CodUnidade\": 215,\n//    \"CodMovimento\": \"-215021504130003\",\n//    \"intMesRef\": 1,\n//    \"Abatimento\": 0,\n//    \"Acréscimo\": 0,\n//    \"AcréscimoProgramado\": 0,\n//    \"AnoLcto\": null,\n//    \"AnoPgto\": null,\n//    \"AnoRef\": 2016,\n//    \"Bolsa\": 0,\n//    \"BolsaCondicional\": 18,\n//    \"Caixa\": \"Bradesco\",\n//    \"CréditoTerceiro\": 0,\n//    \"Curso\": \"Mestrado em Ciências da Educação\",\n//    \"CursoAbreviado\": \"Me. C. Educação\",\n//    \"MesLcto\": null,\n//    \"MesPgto\": null,\n//    \"MesRef\": \"01-Janeiro\",\n//    \"NomeAluno\": \"ELIANA CARDOSO DE SENA\",\n//    \"PagarValor\": 360,\n//    \"PagoData\": null,\n//    \"PagoValor\": 0,\n//    \"Parcela\": 20,\n//    \"QuitaçãoDescrição\": \"Manual\",\n//    \"TipoCobrança\": \"Mensalidade\",\n//    \"TurmaComplementoCompleta\": \"Turma 07\",\n//    \"ValorAberto\": 342,\n//    \"ValorCorrigido\": 342,\n//    \"ValorPagoCorrigido\": 342,\n//    \"Unidade\": \"Ieses / Cariacica\",\n//    \"Ajuizada\": false,\n//    \"Cancelada\": false,\n//    \"CodCaixa\": 6,\n//    \"ValorContabilizado\": 0,\n//    \"DataVencimento\": \"2016-01-15T00:00:00.000Z\"\n//}\n\n\nlet createInvoice = (unidade,boleto) => {\n    let iuguUnidade = iugu(unidade.key,'v1');\n\n    let vencimento = new Date(boleto.DataVencimento);\n\n    let multa = (boleto.PagarValor * multaPercentual / 100) * 100;\n\n\n    let isLate = (vencimento) => {\n        let today = new Date();\n\n        var timeDiff = vencimento - today;\n        var diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));\n\n        return diffDays < 0\n    };\n\n\n    let discount = (bolsaCondicional, bolsa, vencimento) => {\n        let valor = 0;\n\n\n        if (bolsa) {\n            valor += bolsa;\n        }\n\n        if (bolsaCondicional && !isLate(vencimento)) {\n            valor += bolsaCondicional;\n        }\n\n\n        return valor * 100; // deve ser em centavos\n    };\n\n    let price_cents = (valorPagar, valorCorrigido, vencimento) => {\n\n        let valorFinal = 0;\n\n        if (isLate(vencimento)) {\n            valorFinal += valorCorrigido;\n        } else {\n            valorFinal += valorPagar;\n        }\n\n\n        //retornando em centavos\n        return valorFinal * 100;\n\n    };\n\n    let objectInvoice = {\n        email: 'clayton@xdevel.com.br', //todo colocar email na view\n        due_date: '14/01/2016', //vencimento.toLocaleDateString('pt-BR'),\n        items: [{\n            description: \"{} Ref: {}/{} do Curso {}\".format(boleto.TipoCobrança, boleto.intMesRef, boleto.AnoRef, boleto.Curso),\n            quantity: \"1\",\n            price_cents: price_cents(boleto.ValorCorrigido, boleto.ValorCorrigido , vencimento).toString()\n        }],\n        notification_url: 'http://localhost', //todo ajustar o endpoint para processar retorno\n        fines: \"true\",\n        late_payment_fine: multa.toString(),\n        discount_cents: \"0\",\n        per_day_interest: \"true\",\n        ignore_due_email: \"true\",\n        payable_with: 'bank_slip'\n    };\n\n\n    let test = {\n        email: \"teste@teste.com\",\n        due_date: \"30/11/2014\",\n        items: [{\n            description: \"Item Um\",\n            quantity: \"1\",\n            price_cents: \"1000\"\n        }]\n    };\n\n    iuguUnidade.invoices.create(test, function (err, customer) {\n            //err; // null se não ocorreu nenhum erro\n            //customer; // O objeto de retorno da criação\n            if (err){\n                console.log('erro ... ');\n                console.log(err);\n            }else{\n                console.log(customer);\n            }\n\n        }\n    );\n\n\n};\n\n\nmodule.exports = {\n    createInvoice : createInvoice\n};\n\n\n\n\n\n\n"]}